# Maintainer : Philip MÃ¼ller <philm@manjaro.org>

pkgname=kf5-partitionmanager
_pkgname=partitionmanager
pkgver=1.1.60
pkgrel=1
pkgdesc="Easily manage disks, partitions and file systems on your KDE Desktop"
arch=('i686' 'x86_64')
url="https://sourceforge.net/projects/partitionman"
license=('GPL2')
depends=('kconfig' 'frameworkintegration' 'kguiaddons' 'ki18n' 'kiconthemes' 'kinit' 'kio'
         'kjobwidgets' 'kservice' 'kparts' 'ktexteditor' 'kwindowsystem' 'kxmlgui' 'kwidgetsaddons'
         'parted' 'libatasmart' 'udisks2')
makedepends=('extra-cmake-modules' 'git' 'pkgconfig' 'kdoctools')
optdepends=('e2fsprogs: ext2/3/4 support'
	    'xfsprogs: XFS support'
	    'jfsutils: JFS support'
	    'reiserfsprogs: Reiser support'
	    'ntfsprogs: NTFS support'
	    'dosfstools: FAT32 support')
groups=('system')
install=partitionmanager.install	
source=("git://anongit.kde.org/partitionmanager#branch=frameworks")
md5sums=('SKIP')
conflicts=($_pkgname)

pkgver() {
  cd $_pkgname
  git describe --long | sed -e 's|-|.|g' | sed -e 's|v||g'
}

build() {
  cd "${srcdir}"
  # filsystem code from src/fs/filesystem.h, set as default
  sed -i -e 's/FileSystem::Ext3/FileSystem::Ext4/' ${srcdir}/$_pkgname/src/config.kcfg
  
  sed -i 's|KF5 CONFIG REQUIRED|KF5 REQUIRED|' ${srcdir}/$_pkgname/CMakeLists.txt
  
  mkdir build
  cd build

  cmake ../$_pkgname \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo \
        -DENABLE_UDISKS2=on \
        -DLIB_INSTALL_DIR=lib \
        -DSYSCONF_INSTALL_DIR=/etc \
        -DQML_INSTALL_DIR=/usr/lib/qt5/qml \
        -DPLUGIN_INSTALL_DIR=/usr/lib/qt5/plugins \
        -DBUILD_TESTING=OFF 

  make 
}

package() {
  cd build
  
  make DESTDIR="${pkgdir}" install 
}

